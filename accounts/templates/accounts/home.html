<!-- accounts/templates/accounts/home.html -->

{% extends 'accounts/base.html' %}
{% load static %}
{% block content %}
<div class="hero-section">
    <h1>Welcome to Community Food Exchange</h1>
    <p>This is a platform where you can exchange your surplus food items with other community members.</p>
    <p>Explore the listings, send exchange requests, chat with other users, and join community events.</p>
</div>

<div class="container">
    {% if action_message %}
    <div class="notification">
        {{ action_message }}
    </div>
    {% endif %}
    <section class="listings-section">
        <h2>Available Food for Exchange</h2>
        <div class="listings-grid">
            {% for listing in featured_listings %}
            <div class="listing-card">
                <img src="{{ listing.image.url }}" alt="{{ listing.item_name }}">
                <div class="listing-details">
                    <h3>{{ listing.item_name }}</h3>
                    <p>{{ listing.description }}</p>
                    <p>Quantity: {{ listing.quantity }}</p>
                    <p>Expiration Date: {{ listing.expiration_date }}</p>
                    <p>Posted by: {% if user == listing.user %}My Post{% else %}{{ listing.user.username }}{% endif %}</p>
                    <div class="actions">
                        <a href="{% url 'listing_detail' listing.id %}" class="btn btn-view-details">View Details</a>
                        {% if user.is_authenticated and user != listing.user %}
                            <a href="{% url 'send_exchange_request' listing.id %}" class="btn btn-exchange-request">Send Exchange Request</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="create-listing">
            <a href="{% url 'listing_create' %}" class="btn btn-add-item">Add an Item</a>
        </div>
    </section>

    <section class="events-section">
        <h2>Upcoming Events</h2>
        <ul class="events-list">
            {% for event in upcoming_events %}
            <li>
                <h3>{{ event.event_name }}</h3>
                <p>{{ event.description }}</p>
                <p>Date: {{ event.date }}</p>
                <p>Location: {{ event.location }}</p>
                <div class="event-actions">
                    <a href="{% url 'event_detail' event.id %}" class="btn btn-view-details">View Details</a>
                    <a href="{% url 'event_rsvp' event.id %}" class="btn btn-rsvp">RSVP</a>
                </div>
            </li>
            {% endfor %}
        </ul>
    </section>

    <!-- Display latest messages -->
    <section class="latest-messages-section">
        <h2>Your Messages</h2>
        {% if unread_messages_count > 0 %}
        <div class="notification">
            <a href="{% url 'exchange_requests' %}" class="btn btn-message">
                <i class="bi bi-bell-fill"></i>
                {% if exchange_requests %}
                    <span class="badge">{{ unread_messages_count }}</span>
                {% endif %}
                <span class="message-prompt"></span>
            </a>
        </div>
        {% endif %}
    </section>
     <!-- Display request messages -->
     <section class="request-messages-section">
        <h2>Request Messages</h2>
        {% if exchange_requests %}
        <ul>
            {% for request in exchange_requests %}
            <li>
                <p>Listing: {{ request.listing.item_name }}</p>
                <p>Status: {{ request.status }}</p>
                <p>Message: {{ request.message }}</p>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>No request messages yet.</p>
        {% endif %}
    </section>
</div>

{% endblock %}
